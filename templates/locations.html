{% extends "base.html" %}
{% block title %}Location Management{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-6">Location Management</h1>

<!-- Filter -->
<form method="get" action="{{ url_for('locations') }}" class="mb-6 max-w-xl">
  <label class="block font-medium mb-1">Filter by Location</label>
  <div class="flex gap-2">
    <input type="text" name="location" value="{{ q_loc or '' }}"
           class="border rounded px-3 py-2 w-full" placeholder="Type or pick a location">
    <button class="bg-fuchsia-600 text-white px-4 py-2 rounded hover:bg-fuchsia-700">Filter</button>
    <a href="{{ url_for('locations') }}" class="px-3 py-2 border rounded">Clear</a>
  </div>
  {% if suggested_locations %}
    <div class="text-sm text-fuchsia-900/70 mt-2">
      Suggestions:
      {% for l in suggested_locations[:10] %}
        <a class="underline mr-2" href="{{ url_for('locations', location=l) }}">{{ l }}</a>
      {% endfor %}
    </div>
  {% endif %}
</form>

<!-- Nieuwe koppeling -->
<form method="post" action="{{ url_for('locations') }}"
      class="bg-white p-6 rounded shadow-md mb-6 max-w-xl">
  <div class="mb-4">
    <label for="location" class="block font-medium">Location</label>
    <input list="locationList" type="text" name="location" id="location"
           class="mt-1 w-full border rounded px-3 py-2" placeholder="e.g. A-01-01" required>
    <datalist id="locationList">
      {% for l in suggested_locations %}
        <option value="{{ l }}"></option>
      {% endfor %}
      {% if raw_loc_ids %}
        <option disabled>──────────</option>
        {% for l in raw_loc_ids %}
          <option value="{{ l }}"></option>
        {% endfor %}
      {% endif %}
    </datalist>
  </div>

  <div class="mb-4">
    <label for="barcode" class="block font-medium">Barcode</label>
    <input type="text" name="barcode" id="barcode"
           class="mt-1 w-full border rounded px-3 py-2"
           placeholder="Scan or type barcode" required>
  </div>

  <button type="submit" class="bg-fuchsia-600 text-white px-4 py-2 rounded hover:bg-fuchsia-700">
    Assign Barcode
  </button>
</form>

<!-- Overzicht bestaande koppelingen -->
<div class="bg-white p-6 rounded shadow-md">
  <h2 class="text-xl font-semibold mb-4">Linked Items</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead>
        <tr class="text-left border-b">
          <th class="py-2 pr-4">ID</th>
          <th class="py-2 pr-4">Barcode</th>
          <th class="py-2 pr-4">Location</th>
          <th class="py-2 pr-4">User</th>
          <th class="py-2 pr-4">Linked at</th>
          <th class="py-2 pr-4">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr class="border-b last:border-0">
            <td class="py-2 pr-4">{{ r.id }}</td>
            <td class="py-2 pr-4 font-mono">{{ r.barcode }}</td>
            <td class="py-2 pr-4">{{ r.location }}</td>
            <td class="py-2 pr-4">{{ r.username or "-" }}</td>
            <td class="py-2 pr-4">{{ r.linked_at }}</td>
            <td class="py-2 pr-4">
              <form method="post" action="{{ url_for('locations_remove') }}" class="inline">
                <input type="hidden" name="id" value="{{ r.id }}">
                <input type="hidden" name="location" value="{{ r.location }}">
                <button class="text-red-600 hover:underline" type="submit">Unlink</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="6" class="text-gray-500 py-3">No links found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
